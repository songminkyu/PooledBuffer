# PooledBufferManagement

네트워크 통신 및 데이터 처리 작업을 위한 메모리 단편화를 최소화하고 애플리케이션 성능을 향상시키는 `ArrayPool` 기반의 고성능 버퍼 관리 라이브러리입니다.

## 개요

이 프로젝트는 대용량 데이터를 처리하거나 빈번한 버퍼 할당이 필요한 애플리케이션을 위한 효율적인 메모리 관리 기법을 보여줍니다. `ArrayPool` 메커니즘을 통한 풀링된 메모리 자원을 활용함으로써 가비지 컬렉션 부담과 메모리 단편화를 줄이는데 도움이 되며, 이는 특히 높은 처리량을 요구하는 애플리케이션에 유용합니다.

## 주요 구성 요소

### RentedBuffer<T>

`ArrayPool`에서 메모리를 빌려오고 해제될 때 자동으로 반환하는 제네릭 버퍼 구현체입니다. 주요 기능은 다음과 같습니다:

- 할당을 최소화하고 GC 부담을 줄이기 위한 메모리 풀링
- 동시 환경을 위한 스레드 안전 작업
- 적절한 경계 검사를 통한 읽기 및 쓰기 작업 지원
- 대용량 데이터를 위한 병렬 처리를 통한 최적화된 메모리 복사
- 중앙 집중식 할당 및 회수를 통한 효율적인 메모리 사용

### ArrayPoolAllocator<T>

다양한 버퍼 크기를 관리하는 정적 유틸리티 클래스입니다:

- 작은 배열(≤1024)과 큰 배열(>1024)을 위한 별도의 풀
- 0 길이 요청을 위한 공유 빈 배열 인스턴스
- 요청된 크기에 따른 자동 풀 선택
- 보안에 민감한 애플리케이션을 위한 메모리 초기화 옵션

## 사용 시나리오

이 라이브러리는 다음과 같은 상황에 특히 적합합니다:

1. **네트워크 통신**: 최소한의 메모리 오버헤드로 네트워크 패킷 및 스트림을 효율적으로 처리
2. **대용량 데이터 처리**: 메모리 단편화를 줄이면서 상당한 데이터셋 처리
3. **높은 처리량의 애플리케이션**: 빈번한 버퍼 할당 및 해제가 발생하는 시나리오에서 성능 유지
4. **자원 제약 환경**: 제한된 자원 환경에서 메모리 사용 최적화

## 사용 예제

제공된 샘플 코드는 여러 실용적인 애플리케이션을 보여줍니다:

1. **기본 버퍼 작업**: 버퍼 생성, 쓰기, 읽기 및 관리
2. **네트워크 통신**: 풀링된 버퍼를 사용한 TCP 에코 서버 및 클라이언트 구현
3. **성능 비교**: 표준 할당 대비 풀링된 버퍼 성능 비교
4. **패킷 처리**: 효율적인 버퍼 관리를 사용한 구조화된 네트워크 패킷 처리
5. **메시지 빌딩**: 최적화된 메모리 사용으로 대용량 메시지 구성 및 스트리밍

## 성능 이점

성능 테스트는 풀링된 버퍼 사용 시 다음과 같은 중요한 개선 사항을 보여줍니다:

- 할당 및 해제 오버헤드 감소
- 메모리 단편화 감소
- 가비지 컬렉션 부담 감소 및 수집 횟수 감소
- 대용량 작업에 대한 처리량 개선

## 시작하기

1. 이 라이브러리를 프로젝트에 추가
2. 표준 배열 할당을 `RentedBuffer<T>` 인스턴스로 대체
3. `using` 문 또는 명시적 `Dispose()` 호출을 통해 버퍼의 적절한 해제 보장
4. 고급 시나리오의 경우, 패킷 처리 및 메시지 빌딩을 위한 특수 유틸리티 클래스 활용

## 모범 사례

1. 사용이 끝난 `RentedBuffer<T>` 인스턴스는 항상 해제하되, 가급적 `using` 문 사용
2. 불필요한 과대 할당을 피하기 위해 적절한 버퍼 크기 사용
3. 스레드 간에 버퍼를 공유할 때 스레드 안전성 요구사항 고려
4. 매우 큰 데이터셋의 경우, 라이브러리의 병렬 처리 기능 활용

## 요구사항

- .NET 6.0 이상
- System.Buffers 패키지 (ArrayPool 지원용)

## 라이센스

[MIT 라이센스](LICENSE)

##출저
 - https://gist.github.com/berrzebb
